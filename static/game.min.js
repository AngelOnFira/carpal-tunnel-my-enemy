function setup(){init()}function draw(){spawn(),drawAll()}function mousePressed(){}function Enemy(i){var t,e;0==i?(t=random(250,450),e=-20):1==i?(t=720,e=random(250,450)):2==i?(t=random(250,450),e=720):3==i&&(t=-20,e=random(250,450)),this.lane=i,this.position={},this.position.x=float(t),this.position.y=float(e),this.health=50,this.incomingProjectiles=[],this.speed=1}function Wall(i,t,e){this.vert=e,this.position={},this.position.x=i,this.position.y=t,this.health=2,this.dims={},e?(this.dims.x=10,this.dims.y=100,this.position.x-=5,this.position.y-=50):(this.dims.x=100,this.dims.y=10,this.position.x-=50,this.position.y-=5)}function spawn(){random([0,1,2,3]);if(nextSpawn<millis()){for(var i=0;i<4;i++).5<random(0,1)&&enemies[i].push(new Enemy(i));nextSpawn=millis()+2e3-(millis()-startTime)/100,lastSpawn=millis()}}function init(){console.log("Init");var i=createCanvas(700,700),t=(windowWidth-width)/2,e=(windowHeight-height)/2;i.position(t,e),enemies=[[],[],[],[]],wallsAlive=[1,1,1,1],walls=[],towers=[],buttons=[],walls.push(new Wall(350,250,0)),walls.push(new Wall(450,350,1)),walls.push(new Wall(350,450,0)),walls.push(new Wall(250,350,1)),towers.push(new Tower(280,280)),towers.push(new Tower(390,280)),towers.push(new Tower(390,390)),towers.push(new Tower(280,390)),startTime=millis(),lastSpawn=millis(),nextSpawn=millis(),currentSpawnTime=5e3,frameRate(30),money=0,globalDamage=10,buttons.push(new Button(20,70,"Increase Damage - 20g",increaseDamage)),tutorial={w:1,a:1,s:1,d:1},gameOver=0,playerOrb=new PlayerOrb,console.log("Starting")}function Tower(i,t,e){this.position={},this.position.x=i,this.position.y=t,this.health=500}function mouseClicked(){for(var i=0;i<buttons.length;i++){buttons[i].checkTriggered()}}function keyPressed(){65!=keyCode&&97!=keyCode||(tutorial.a=0,towers[0].fire(3),towers[3].fire(3)),87!=keyCode&&119!=keyCode||(tutorial.w=0,towers[0].fire(0),towers[1].fire(0)),68!=keyCode&&100!=keyCode||(tutorial.d=0,towers[1].fire(1),towers[2].fire(1)),83!=keyCode&&115!=keyCode||(tutorial.s=0,towers[2].fire(2),towers[3].fire(2))}function Projectile(i,t,e){this.position={},this.position.x=i,this.position.y=t,this.damage=e}function distNS(i,t,e,o){return Math.pow(i-e,2)+Math.pow(t-o,2)}function distS(i,t,e,o){return Math.sqrt(distNS(i,t,e,o))}function calcMovement(i,t,e,o,s){var n=e-i,r=o-t,l=distS(i,t,e,o);return[n/l*s,r/l*s]}function Button(i,t,e,o){this.position={},this.position.x=i,this.position.y=t,this.size={},this.size.x=160,this.size.y=20,this.text=e,this.onTrigger=o}function increaseDamage(){20<=money&&(money-=20,globalDamage+=5)}function drawAll(){drawBackground(),drawScene(),drawHUD();var i=color(255,255,255);fill(i)}function drawBackground(){var i=color(0,0,0);fill(i),rect(0,0,700,700)}function drawScene(){for(var i=0;i<towers.length;i++){var t=towers[i],e=color(40,40,220);fill(e),noStroke(),rect(t.position.x,t.position.y,30,30)}for(var o=0;o<4;o++)for(var s=0;s<enemies[o].length;){var n=enemies[o][s];if(n.update())enemies[o].splice(s,1);else{s+=1;e=color(255-(n.health/50*200+40),n.health/50*200+40,0);fill(e),noStroke(),rect(int(n.position.x-10),int(n.position.y-10),20,20);for(var r=n.incomingProjectiles.length,l=0;l<r;l++){var a=n.incomingProjectiles[l];e=color(220,10,10);fill(e),ellipse(a.position.x,a.position.y,10)}}}for(i=0;i<walls.length;i++){var h=walls[i];e=color(255-(h.health/2*200+40),h.health/2*200+40,0);fill(e),noStroke(),rect(h.position.x,h.position.y,h.dims.x,h.dims.y)}e=color(255-(playerOrb.health/500*200+40),playerOrb.health/500*200+40,0);fill(e),noStroke(),ellipse(350,350,40,40)}function drawHUD(){var i=color(255,255,255);fill(i),textSize(18),text("Gold: "+money,20,50);for(var t=0;t<buttons.length;t++){var e=buttons[t];i=color(255,255,255);fill(i),rect(e.position.x,e.position.y,e.size.x,e.size.y);i=color(0,0,0);fill(i),textSize(12),text(e.text,e.position.x+10,e.position.y+15)}i=color(255,255,255);if(fill(i),textSize(30),tutorial.w&&text("W",335,305),tutorial.a&&text("A",285,360),tutorial.s&&text("S",340,415),tutorial.d&&text("D",395,360),gameOver){i=color(0,0,0);fill(i),stroke(255,255,255),strokeWeight(4),rect(165,290,400,100),noStroke();i=color(255,255,255);fill(i),textSize(60),text("Game Over",195,360)}textSize(18)}function PlayerOrb(){this.health=500}Enemy.prototype.update=function(){if(this.move(),this.updateIncomingProjectiles(),this.checkAlive())return 1},Enemy.prototype.move=function(){var i=calcMovement(this.position.x,this.position.y,350,350,this.speed);this.position.x+=i[0],this.position.y+=i[1]},Enemy.prototype.checkAlive=function(){if(this.health<=0)return money+=1,1;if(0==this.lane){if(250<this.position.y)return this.die(),1}else if(1==this.lane){if(this.position.x<450)return this.die(),1}else if(2==this.lane){if(this.position.y<450)return this.die(),1}else if(3==this.lane&&250<this.position.x)return this.die(),1;return 0},Enemy.prototype.die=function(){wallsAlive[this.lane]?(walls[this.lane].health-=2,walls[this.lane].update&&(splice(walls[(this.lane,1)]),wallsAlive[this.lane]=0)):gameOver=1},Enemy.prototype.shoot=function(i,t){this.incomingProjectiles.push(new Projectile(i+15,t+15,globalDamage))},Enemy.prototype.updateIncomingProjectiles=function(){for(var i=0;i<this.incomingProjectiles.length;){var t=this.incomingProjectiles[i];t.update(this.position.x,this.position.y)?(this.health-=t.damage,this.incomingProjectiles.splice(i,1)):i++}},Wall.prototype.update=function(){return this.health<=0?1:0},Tower.prototype.findTarget=function(i){for(var t=-1,e=0,o=0;o<enemies[i].length;o++){var s=enemies[i][o];distance=distNS(s.position.x,s.position.y,this.position.x,this.position.y),(distance<t||-1==t)&&(t=distance,e=o)}-1!=t&&enemies[i][e].shoot(this.position.x,this.position.y)},Tower.prototype.fire=function(i){this.findTarget(i)},Projectile.prototype.update=function(i,t){var e=calcMovement(this.position.x,this.position.y,i,t,10);return this.position.x+=e[0],this.position.y+=e[1],distNS(this.position.x,this.position.y,i,t)<100?1:0},Button.prototype.checkTriggered=function(){mouseX>this.position.x&&mouseX<this.position.x+this.size.x&&mouseY>this.position.y&&mouseY<this.position.y+this.size.y&&this.onTrigger()},PlayerOrb.prototype.takeDamage=function(i){this.health-=i,this.health<=0&&this.die()},PlayerOrb.prototype.die=function(){gameOver=1};