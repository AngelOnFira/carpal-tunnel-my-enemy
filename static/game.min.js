function setup(){init()}function draw(){spawn(),rect(0,0,700,700);for(var i=0;i<towers.length;i++){var t=towers[i],e=color(40,40,220);fill(e),noStroke(),rect(t.position.x,t.position.y,30,30)}for(var o=0;o<4;o++)for(var s=0;s<enemies[o].length;){var n=enemies[o][s];if(n.update())enemies[o].splice(s,1);else{s+=1;e=color(255-(n.health/50*200+40),n.health/50*200+40,0);fill(e),noStroke(),rect(int(n.position.x-10),int(n.position.y-10),20,20);for(var r=n.incomingProjectiles.length,h=0;h<r;h++){var l=n.incomingProjectiles[h];e=color(220,10,10);fill(e),ellipse(l.position.x,l.position.y,10)}}}for(i=0;i<walls.length;i++){var p=walls[i];e=color(255-(p.health/500*200+40),p.health/500*200+40,0);fill(e),noStroke(),rect(p.position.x,p.position.y,p.dims.x,p.dims.y)}e=color(255,255,255);fill(e),textSize(18),text("Gold: "+money,20,50);e=color(0,0,0);fill(e)}function mousePressed(){}function Enemy(i){var t,e;0==i?(t=random(250,450),e=-20):1==i?(t=720,e=random(250,450)):2==i?(t=random(250,450),e=720):3==i&&(t=-20,e=random(250,450)),this.lane=i,this.position={},this.position.x=t,this.position.y=e,this.health=50,this.incomingProjectiles=[]}function Wall(i,t,e){this.vert=e,this.position={},this.position.x=i,this.position.y=t,this.health=500,this.dims={},e?(this.dims.x=10,this.dims.y=100,this.position.x-=5,this.position.y-=50):(this.dims.x=100,this.dims.y=10,this.position.x-=50,this.position.y-=5)}function spawn(){var i=random([0,1,2,3]);millis()-lastSpawn>currentSpawnTime&&(enemies[i].push(new Enemy(i)),lastSpawn=millis())}function init(){var i=createCanvas(700,700),t=(windowWidth-width)/2,e=(windowHeight-height)/2;i.position(t,e),enemies=[[],[],[],[]],walls=[],towers=[],keysPressed=[0,0,0,0],walls.push(new Wall(350,250,0)),walls.push(new Wall(450,350,1)),walls.push(new Wall(350,450,0)),walls.push(new Wall(250,350,1)),towers.push(new Tower(280,280)),towers.push(new Tower(390,280)),towers.push(new Tower(280,390)),towers.push(new Tower(390,390)),startTime=millis(),currentSpawnTime=200,lastSpawn=millis(),frameRate(30),money=0}function Tower(i,t,e){this.position={},this.position.x=i,this.position.y=t,this.health=500}function keyPressed(){65!=keyCode&&97!=keyCode||(towers[0].fire(3),towers[3].fire(3)),87!=keyCode&&119!=keyCode||(towers[0].fire(0),towers[1].fire(0)),68!=keyCode&&100!=keyCode||(towers[1].fire(1),towers[2].fire(1)),83!=keyCode&&115!=keyCode||(towers[2].fire(2),towers[3].fire(2))}function Projectile(i,t,e){this.position={},this.position.x=i,this.position.y=t,this.damage=e}function distNS(i,t,e,o){return Math.pow(i-e,2)+Math.pow(t-o,2)}function distS(i,t,e,o){return Math.sqrt(distNS(i,t,e,o))}function calcMovement(i,t,e,o,s){var n=e-i,r=o-t,h=distS(i,t,e,o);return[n/h*s,r/h*s]}Enemy.prototype.update=function(){if(this.move(),this.updateIncomingProjectiles(),this.checkAlive())return 1},Enemy.prototype.move=function(){0==this.lane?this.position.y+=1:1==this.lane?this.position.x-=1:2==this.lane?this.position.y-=1:3==this.lane&&(this.position.x+=1)},Enemy.prototype.checkAlive=function(){if(this.health<=0)return money+=1,1;if(0==this.lane){if(250<this.position.y)return this.die(),1}else if(1==this.lane){if(this.position.x<450)return this.die(),1}else if(2==this.lane){if(this.position.y<450)return this.die(),1}else if(3==this.lane&&250<this.position.x)return this.die(),1;return 0},Enemy.prototype.die=function(){walls[this.lane].health-=30},Enemy.prototype.shoot=function(i,t){this.incomingProjectiles.push(new Projectile(i,t,10))},Enemy.prototype.updateIncomingProjectiles=function(){for(var i=0;i<this.incomingProjectiles.length;i++){var t=this.incomingProjectiles[i];t.update(this.position.x,this.position.y)&&(this.health-=t.damage)}},Tower.prototype.findTarget=function(i){for(var t=-1,e=0,o=0;o<enemies[i].length;o++){var s=enemies[i][o];distance=distNS(s.position.x,s.position.y,this.position.x,this.position.y),(distance<t||-1==t)&&(t=distance,e=o)}-1!=t&&enemies[i][e].shoot(this.position.x,this.position.y)},Tower.prototype.fire=function(i){this.findTarget(i)},Projectile.prototype.update=function(i,t){var e=calcMovement(this.position.x,this.position.y,i,t,10);return this.position.x+=e[0],this.position.y+=e[1],distNS(this.position.x,this.position.y,i,t)<100?1:0};